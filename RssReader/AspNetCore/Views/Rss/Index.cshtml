@model Pagination<RssModel>

@{
    ViewBag.Title = "Index";
}
@{
    var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
    var nextDisabled = !Model.HasNextPage ? "disabled" : "";
    var pageSize = Model.PageSize;
    var pageIndex = Model.PageIndex;
    var totalPages = Model.TotalPages;
    var titleToSearch = Model.TitleToSearch;
}

<div class="row">
    <h1>Rss Reader</h1>
    @using (Html.BeginForm())
    {
        <div class="row">
            <div class="col-md-6 col-lg-6 col-sm-12">
                Szukaj po tytule: @Html.TextBox("titleToSearch")
                <input type="submit" value="Szukaj"/>
            </div>
            <div class="col-md-6 col-lg-6 col-sm-12 text-right">
                Ilość elementów na stronie: @Html.TextBox("pageSize")
                <input type="submit" value="Zmień"/>
            </div>
        </div>
    }


    @foreach (var row in Split(Model.RMList, 2))
    {
        <div class="row">
            @foreach (var column in row)
            {
                <div class="col-md-6">
                    <div class="rssItem">
                        <h3 class="rssItemTitle">
                            @column.Title
                        </h3>
                        <div class="rssItemDescription">
                            @Html.Raw(column.Description)
                            <div class="rssItemDate">
                                <p>
                                    @column.Date
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<div class="text-center">
    <ul class="pagination">

        <li class="@prevDisabled">
            <a class="btn @prevDisabled" asp-action="Index" asp-route-page="@(Model.RMList.IndexOf(Model.RMList.FirstOrDefault()) + 2)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                <span>
                    &laquo;
                </span>
            </a>
        </li>

        <li class="@prevDisabled">
            <a class="btn @prevDisabled" asp-action="Index" asp-route-page="@(pageIndex - 1)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                <span>
                    &lt;
                </span>
            </a>
        </li>


        @for (var i = 1; i <= totalPages; i++)
        {
            if (i == Model.PageIndex - 1)
            {
                <li>
                    <a asp-action="Index" asp-route-page="@(pageIndex - 1)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                        @i
                    </a>
                </li>
            }
            if (i == pageIndex)
            {
                <li>
                    <a asp-action="Index" asp-route-page="@(pageIndex)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                        @i
                    </a>
                </li>
            }
            if (i == pageIndex + 1)
            {
                <li>
                    <a asp-action="Index" asp-route-page="@(pageIndex + 1)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                        @i
                    </a>
                </li>
            }
            if (i == pageIndex + 1 && i == 2)
            {
                <li>
                    <a asp-action="Index" asp-route-page="@(pageIndex + 2)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                        @(i + 1)
                    </a>
                </li>
            }
            if (i == pageIndex - 2 && i == totalPages - 2)
            {
                <li>
                    <a asp-action="Index" asp-route-page="@(pageIndex - 2)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                        @(i)
                    </a>
                </li>
            }
        }

        <li class="@nextDisabled">
            <a class="btn @nextDisabled" asp-action="Index" asp-route-page="@(pageIndex + 1)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                <span>
                    &gt;
                </span>
            </a>
        </li>

        <li class="@nextDisabled">
            <a class="btn @nextDisabled" asp-action="Index" asp-route-page="@(totalPages)" asp-route-titleToSearch="@titleToSearch" asp-route-pageSize="@pageSize">
                <span>
                    &raquo;
                </span>
            </a>
        </li>
    </ul>
</div>

@functions
{

    static IEnumerable<IEnumerable<T>> Split<T>(IEnumerable<T> rssList, int columns)
    {
        for (var i = 0; i < (double) rssList.Count() / columns; i++)
        {
            yield return rssList.Skip(i * columns).Take(columns);
        }
    }

}